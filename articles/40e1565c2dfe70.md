---
title: "ã€Flutterã€‘ go_routerã§TabBarView(+Î± in BottomNavigationBar)ã®ç”»é¢é·ç§»ã®æ–¹æ³•"
emoji: "ğŸ›£"
type: "tech"
topics: ["flutter", "dart"]
published: true
---

# ã¯ã˜ã‚ã«

å˜ã«TabBarViewå†…ã®ç”»é¢åˆ‡ã‚Šæ›¿ãˆã‚’ã™ã‚‹ãªã‚‰ã€ã‚ˆãã‚ã‚‹ä»¥ä¸‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¿ãŸã„ãªã‚‚ã®ã‚’ä½¿ã„

```dart
class MyDemo extends StatelessWidget {
  const MyDemo({super.key});

  static const List<Tab> myTabs = <Tab>[
    Tab(text: 'LEFT'),
    Tab(text: 'RIGHT'),
  ];

  @override
  Widget build(BuildContext context) {
    return DefaultTabController(
      length: myTabs.length,
      child: Scaffold(
        appBar: AppBar(
          bottom: const TabBar(
            tabs: myTabs,
          ),
        ),
        body: TabBarView(
          children: myTabs.map((Tab tab) {
            final String label = tab.text!.toLowerCase();
            return Center(
              child: Text(
                'This is the $label tab',
                style: const TextStyle(fontSize: 36),
              ),
            );
          }).toList(),
        ),
      ),
    );
  }
}
```

â†‘ å…¬å¼ã‚ˆã‚Š
https://api.flutter.dev/flutter/material/DefaultTabController-class.html


å†…éƒ¨çš„ãªä»•çµ„ã¿ã§ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆã‚’ã‚„ã£ã¦ãã‚Œã‚‹ãŸã‚ã€go_routerã‚’ä½¿ã£ãŸé·ç§»ã‚³ãƒ¼ãƒ‰ã¯ç‰¹ã«ä¸è¦ã§ã™ã€‚

ãŸã ã€TabBarViewã®å¤–å´(åˆ¥ç”»é¢ã€ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é–‹å°ã‹ã‚‰ã®é·ç§»ã‚„ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ãªã©ã®å¤–ã®ä¸–ç•Œ)ã‹ã‚‰é·ç§»ã—ã¦ç›´æ¥ç‰¹å®šã®ã‚¿ãƒ–ã«é·ç§»(åˆ‡ã‚Šæ›¿ãˆ)ã™ã‚‹å ´åˆã¯go_routerã§çµ±ä¸€ã—ã¦é·ç§»ã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

# ç’°å¢ƒ

* Flutter 3.10.6
* go_router 10.1.2

# æ–¹æ³•

â€» go_routerã®åŸºæœ¬çš„ãªèª¬æ˜ç­‰ã¯å‰²æ„›ã—ã¾ã™

ãƒã‚¹ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¶­æŒãŒã§ãã‚‹`StatefulShellRoute`ã‚’ä½¿ã£ã¦å®Ÿç¾ã§ãã¾ã™

https://pub.dev/documentation/go_router/latest/go_router/StatefulShellRoute-class.html

> Similar to ShellRoute, this route class places its sub-route on a different Navigator than the root Navigator.

ShellRoute(ãƒã‚¹ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ç¶­æŒãŒã§ããªã„èª²é¡ŒãŒã‚ã£ãŸã‚¯ãƒ©ã‚¹)ã¨åŒæ§˜ã«ã€ã‚µãƒ–ãƒ«ãƒ¼ãƒˆã®é…ç½®ãŒã§ãã¾ã™ãŒ

> However, this route class differs in that it creates separate Navigators for each of its nested branches (i.e. parallel navigation trees), making it possible to build an app with stateful nested navigation. This is convenient when for instance implementing a UI with a BottomNavigationBar, with a persistent navigation state for each tab.

ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒ(ä¸¦åˆ—ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒªãƒ¼)ã”ã¨ã«åˆ¥ã€…ã®Navigatorã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¦ã€ã‚¿ãƒ–å†…ç¶­æŒ(ä¾‹ BottomNavigationBar)ãªã©ãŒã§ãã‚‹çŠ¶æ…‹ã‚’æŒã£ãŸãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ç”»é¢é·ç§»å›³

ä»¥ä¸‹ã®ã‚ˆã†ãªTabBarView in BottomNavigationBar ãªç”»é¢é·ç§»æ§‹æˆã§è©¦ã—ã¦ã¾ã™

![](https://storage.googleapis.com/zenn-user-upload/ce67d8f02bd8-20230919.png)


## å®Ÿç¾æ–¹æ³•

GoRouterã®å®šç¾©ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã—ãŸ

```dart
import 'package:flutter/material.dart';
import 'package:flutter_playground/sample_pages.dart';
import 'package:flutter_playground/custom_scaffold.dart';
import 'package:go_router/go_router.dart';

final rootNavigatorKey = GlobalKey<NavigatorState>(debugLabel: 'RootNavigator');
final homeNavigatorKey = GlobalKey<NavigatorState>(debugLabel: 'HomeNavigator');
final topNavigatorKey =
    GlobalKey<NavigatorState>(debugLabel: 'TopTabNavigator');
final carTopTabNavigatorKey =
    GlobalKey<NavigatorState>(debugLabel: 'CarTopTabNavigation');
final trainTopTabNavigatorKey =
    GlobalKey<NavigatorState>(debugLabel: 'TrainTopTabNavigation');

final router = GoRouter(
  initialLocation: '/home',
  navigatorKey: rootNavigatorKey,
  routes: [
    StatefulShellRoute(
      builder: (context, state, navigationShell) => navigationShell,
      navigatorContainerBuilder: (context, navigationShell, children) =>
          ScaffoldWithNaviBar(
        navigationShell: navigationShell,
        children: children,
      ),
      branches: [
        StatefulShellBranch(
          navigatorKey: homeNavigatorKey,
          routes: [
            GoRoute(
              path: '/home',
              name: 'home',
              builder: (context, state) => const HomePage(),
              routes: [
                GoRoute(
                  path: 'a',
                  name: 'APage',
                  builder: (context, state) => const APage(),
                  routes: [
                    GoRoute(
                      path: 'b',
                      name: 'BPage',
                      // é€”ä¸­ã§è¦ªã®Navigatorã§è¡¨ç¤ºã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
                      parentNavigatorKey: rootNavigatorKey,
                      pageBuilder: (context, state) => const MaterialPage(
                        fullscreenDialog: true,
                        child: BPage(),
                      ),
                    ),
                  ],
                ),
              ],
            ),
          ],
        ),
        StatefulShellBranch(
          navigatorKey: topNavigatorKey,
          routes: [
            StatefulShellRoute(
              builder: (context, state, navigationShell) => navigationShell,
              navigatorContainerBuilder: (context, navigationShell, children) =>
                  ScaffoldWithTabBarView(
                navigationShell: navigationShell,
                children: children,
              ),
              branches: [
                StatefulShellBranch(
                  navigatorKey: carTopTabNavigatorKey,
                  routes: [
                    GoRoute(
                      path: '/top_tab/car',
                      name: 'CarPage',
                      builder: (context, state) => const CarPage(),
                    ),
                  ],
                ),
                StatefulShellBranch(
                  navigatorKey: trainTopTabNavigatorKey,
                  routes: [
                    GoRoute(
                      path: '/top_tab/train',
                      name: 'TrainPage',
                      builder: (context, state) => const TrainPage(),
                    ),
                  ],
                ),
              ],
            ),
          ],
        ),
      ],
    ),
  ],
);
```

StatefulShellRouteã«æ¸¡ã™ã‚‚ã®ã¨ã—ã¦

* builder â† è¡¨ç¤ºã—ãŸã„ãƒã‚¹ãƒˆã‚’æŒã¤Widget
* navigatorContainerBuilder â† ã‚«ã‚¹ã‚¿ãƒ ç”¨
* branch â† å„StatefulShellBranch

ãŒå¿…è¦ã«ãªã‚Šã¾ã™

`StatefulShellBranch`ã¯StatefulShellRouteã®å„ã‚µãƒ–ãƒ«ãƒ¼ãƒˆã¨ã—ã¦è¨­å®šã™ã‚‹ã‚¯ãƒ©ã‚¹ã«ãªã‚Šã¾ã™(StatefulShellRouteã¨ã‚»ãƒƒãƒˆ)

ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦

```
Tab A â†’ Tab Aç”¨ã®StatefulShellBranch
Tab B â†’ Tab Bç”¨ã®StatefulShellBranch
```

ã§ç”¨æ„ã™ã‚‹æ„Ÿã˜ã§ã™

> A separate Navigator will be built for each StatefulShellBranch in a StatefulShellRoute, and the routes of this branch will be placed onto that Navigator instead of the root Navigator. 

ã¾ãŸã€å„StatefulShellBranchã”ã¨ã«å€‹åˆ¥ã®NavigatorãŒæ§‹ç¯‰ã•ã‚Œã¾ã™
StatefulShellBranchã®routesã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã—ã¦è¨­å®šã—ãŸã„ç”»é¢ã‚’GoRouteã‚¯ãƒ©ã‚¹ã§ãƒ©ãƒƒãƒ—ã—ã¦è¨­å®šãŒã§ãã¾ã™

ä¾‹ 
```dart
 StatefulShellBranch(
          navigatorKey: homeNavigatorKey,
          routes: [
            GoRoute(
              path: '/home',
              name: 'home',
              builder: (context, state) => const HomePage(),
              routes: [
                GoRoute(
                  path: 'a',
                  name: 'APage',
                  builder: (context, state) => const APage(),
                  ....
```

ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¸è¦ã§ã‚ã‚Œã°ã€builderé–¢æ•°ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å´ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹`StatefulShellRoute.indexedStack(å†…éƒ¨çš„ã«OffStageã§è¡¨ç¤ºã—ãŸã„ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆã¦ãã‚Œã‚‹)` â†“

https://pub.dev/documentation/go_router/latest/go_router/StatefulShellRoute/StatefulShellRoute.indexedStack.html

ã‚’æ¸¡ã—ã¦ã‚ã’ã‚Œã°ã„ã„ã§ã™ãŒã€ç‹¬è‡ªã®åˆ‡ã‚Šæ›¿ãˆã®ä»•çµ„ã¿ã‚’ç”¨æ„ã—ãŸã„å ´åˆã¯navigatorContainerBuilderã§è¨­å®šã§ãã¾ã™

ã‚µãƒ³ãƒ—ãƒ«â†“
https://github.com/flutter/packages/blob/0023d01996576e494094793a6552463f01c5627a/packages/go_router/example/lib/others/custom_stateful_shell_route.dart#L35-L55

ãã—ã¦ã€TabBarView in BottomNavigationã®å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªéšå±¤ã§å®Ÿç¾ã§ãã¾ã™

```
GoRouter
 |_ StatefulShellRoute â† BottomNavigationBarç”¨
    |_ StatefulShellBranch(home)
    |_ StatefulShellBranch(topTab)
       |_ StatefulShellRoute â† TabBarViewç”¨
          |_ StatefulShellBranch(car)
          |_ StatefulShellBranch(train page)
```

TabBarViewã‚’å¤–å´ã‹ã‚‰ã®ä»•çµ„ã¿ã§å¤‰æ›´ã‚„StatefulShellBranchã§å®šç¾©ã—ãŸã‚‚ã®ã«é©åˆ‡ã«åˆ‡ã‚Šæ›¿ãˆã‚Œã‚‹ã‚ˆã†ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™

```dart
class ScaffoldWithTabBarView extends StatelessWidget {
  const ScaffoldWithTabBarView({
    super.key,
    required this.navigationShell,
    required this.children,
  });

  final StatefulNavigationShell navigationShell;
  final List<Widget> children;

  @override
  Widget build(BuildContext context) {
    return DefaultTabController(
      length: 2,
      initialIndex: navigationShell.currentIndex,
      child: Builder(
        builder: (context) {
          final tabController = DefaultTabController.of(context);
          tabController.addListener(() {
            if (tabController.indexIsChanging) {
              navigationShell.goBranch(
                tabController.index,
                initialLocation:
                    tabController.index == navigationShell.currentIndex,
              );
            }
          });

          return Scaffold(
            appBar: AppBar(
              bottom: const TabBar(
                tabs: [
                  Tab(icon: Icon(Icons.directions_car)),
                  Tab(icon: Icon(Icons.directions_transit)),
                ],
              ),
              backgroundColor: Theme.of(context).colorScheme.inversePrimary,
              title: const Text('ä¸Šã‚¿ãƒ–ãƒšãƒ¼ã‚¸'),
            ),
            body: TabBarView(children: children),
          );
        },
      ),
    );
  }
}
```

è‡ªä½œã‚¯ãƒ©ã‚¹å†…éƒ¨ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ç”¨æ„ã—ã¦ã„ã‚‹`StatefulNavigationShell`ã‚¯ãƒ©ã‚¹ã¯StatefulShellRouteã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹Widgetã§ã™

ç›´æ¥ã“ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹ã¨ã„ã†ã‚ˆã‚Šã€StatefulShellRouteã®builderã‚„navigatorContainerBuilderé–¢æ•°å†…ã§æ¸¡ã£ã¦ãã¾ã™

```dart
    StatefulShellBranch(
          navigatorKey: topNavigatorKey,
          routes: [
            StatefulShellRoute(
              builder: (context, state, navigationShell) => navigationShell,
              navigatorContainerBuilder: (context, navigationShell, children) => // â†ã“ã“
                  ScaffoldWithTabBarView(
                navigationShell: navigationShell,
                children: children,
              ),
```

StatefulNavigationShellã«goBranchã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã€

https://pub.dev/documentation/go_router/latest/go_router/StatefulNavigationShell/goBranch.html

indexæŒ‡å®šã§é·ç§»ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ãŸã‚ã€DefaultTabControllerã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã®é·ç§»ãŒã§ãã¾ã™â†“

```dart
// ScaffoldWithTabBarView classã‚ˆã‚Š
  Widget build(BuildContext context) {
    return DefaultTabController(
      length: 2,
      initialIndex: navigationShell.currentIndex,
      child: Builder(
        builder: (context) {
          final tabController = DefaultTabController.of(context);
          tabController.addListener(() {
            if (tabController.indexIsChanging) {
              navigationShell.goBranch(
                tabController.index,
                initialLocation:
                    tabController.index == navigationShell.currentIndex,
              );
            }
          });
```

ã¾ãŸã€é·ç§»ã—ãŸã„ç”»é¢ã«é©åˆ‡ã«pathã‚„nameãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°TabBarViewã®å¤–å´ã‹ã‚‰ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«é·ç§»ãŒå¯èƒ½ã§ã™ â†“

```dart
// Homeç”»é¢ã‹ã‚‰åˆ¥ã‚¿ãƒ–å†…ã®ç‰¹å®šã®TabBarViewã¸é·ç§»ã™ã‚‹ä¾‹
import 'package:flutter/material.dart';
import 'package:flutter_playground/non_generated_router.dart';
import 'package:go_router/go_router.dart';

class HomePage extends StatelessWidget {
  const HomePage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
        title: const Text('home'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            ElevatedButton(
              onPressed: () => context.goNamed('APage'),
              child: const Text('Aãƒšãƒ¼ã‚¸é·ç§»'),
            ),
            ElevatedButton(
              onPressed: () => context.goNamed('BPage'),
              child: const Text('Bãƒšãƒ¼ã‚¸é·ç§»'),
            ),
            ElevatedButton(
              onPressed: () => context.goNamed('TrainPage'), // â†ã“ã“ã§é·ç§»
              child: const Text('topTabã®ãƒˆãƒ¬ã‚¤ãƒ³ã¸é·ç§»'),
            ),
          ],
        ),
      ),
    );
  }
}

```

ã¡ã‚‡ã£ã¨ã‚†ã£ãã‚Šã‚ã®gifç”»åƒã§ã™ãŒã€

```
TabBarViewå†…ã®çŠ¶æ…‹ã‚’Carã‚¿ãƒ–ã«ã™ã‚‹
â†“
BottomBarã®ã‚¿ãƒ–ã‚’Homeã«åˆ‡ã‚Šæ›¿ãˆ
â†“
Homeç”»é¢å†…ã®ä¸€ç•ªä¸‹ã«ã‚ã‚‹ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
â†“
BottomBarã‚¿ãƒ–ãŒtopTabã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¤ã¤ã€Trainã‚¿ãƒ–ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹
```

ã¨ã„ã†æ„Ÿã˜ãŒå®Ÿç¾å¯èƒ½ã§ã™

![](https://storage.googleapis.com/zenn-user-upload/f4b170442ee1-20230920.gif =200x)

ä¸€é€£ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯gistã«ã¾ã¨ã‚ã¦ã¾ã™

@[gist](https://gist.github.com/kentomiya89/2de869cb66253236fd563c04f465aec6)

# ãŠã‚ã‚Šã«

ä»–ã«ã‚‚Homeç”»é¢å†…ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤ºã‚„ãƒã‚¹ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰è„±ã—ã¦rootã‹ã‚‰ç”»é¢é·ç§»ã™ã‚‹ä¾‹ã‚‚è¨˜è¼‰ã—ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ãªã‚Œã°ã§ã™

ä½•ã‹ä¸é©åˆ‡ãªå†…å®¹ã®è¨˜è¼‰ã‚„èª¤å­—è„±å­—ç­‰ã‚ã‚Œã°æ°—è»½ã«ã”æŒ‡æ‘˜ãã ã•ã„

# å‚è€ƒã«ã—ãŸã‚‚ã®

å…¬å¼ã‚µãƒ³ãƒ—ãƒ«
https://pub.dev/documentation/go_router/latest/go_router/go_router-library.html
https://github.com/flutter/packages/tree/main/packages/go_router/example

https://www.memory-lovers.blog/entry/2023/07/13/140754
